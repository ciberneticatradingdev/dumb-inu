---
import { CA } from "../utils/utils";

// Determinar si estamos en la página de inicio
const isHomePage = Astro.url.pathname === "/";
---

<section id="navbar" class="bg-[#ba7f21] flex flex-col sm:flex-row items-center justify-between p-4 rounded-[50px] py-3 w-full max-w-4xl mx-auto mt-2 fixed top-0 left-1/2 transform -translate-x-1/2 z-50 transition-all duration-300 opacity-0 pointer-events-none">
    <div class="flex flex-col sm:flex-row items-center w-full justify-between relative">
      <div class="flex justify-between w-full sm:w-auto items-center">
        <img src="/redbull.png" class="max-w-32" />
        <button id="menu-toggle" class="sm:hidden text-white p-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path id="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
          </svg>
        </button>
      </div>
      
      <!-- Navigation Links -->
      <nav id="nav-menu" class="hidden sm:flex flex-col sm:flex-row gap-8 mt-4 sm:mt-0 text-white w-full sm:w-auto">
        <a href={isHomePage ? "#ca" : "/#ca"} class="text-white transition-colors hover:no-underline">Contract Address</a>
        <a href={isHomePage ? "#community" : "/#community"} class="text-white transition-colors hover:no-underline">Community</a>
        <a href="/game" class="text-white transition-colors hover:no-underline">Game</a>
        <div class="relative group">
          <a href="#" class="text-white transition-colors hover:no-underline flex items-center gap-2">
            More
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 transform group-hover:rotate-180 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
            </svg>
          </a>
          <div class="absolute hidden group-hover:block bg-[#0000ce] rounded-lg p-2 mt-2 min-w-[200px] z-50 transform transition-all duration-300 ease-in-out before:content-[''] before:absolute before:top-[-10px] before:left-0 before:w-full before:h-[10px]">
            <a href={isHomePage ? "#roadmap" : "/#roadmap"} class="block hover:no-underline text-white py-3 px-4 hover:bg-[#0000ff] rounded-lg transition-colors">Roadmap</a>
            <a href={isHomePage ? "#faq" : "/#faq"} class="block hover:no-underline text-white py-3 px-4 hover:bg-[#0000ff] rounded-lg transition-colors">FAQ</a>
          </div>
        </div>
      </nav>

      <a href=`https://jup.ag/swap/SOL-${CA}` class="bg-white text-[#0000ce] px-6 py-2 rounded-[50px] font-bold mt-4 sm:mt-0 transition-colors hover:no-underline w-full sm:w-auto text-center">
        Buy Now
      </a>
    </div>
</section>

<style>
  @media (max-width: 640px) {
    #nav-menu {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: #0000ce;
      padding: 1.5rem;
      border-radius: 1.5rem;
      z-index: 50;
      margin-top: 1rem;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
    }
    
    #nav-menu.show {
      display: flex;
    }

    #nav-menu a, #nav-menu button {
      font-size: 1.1rem;
      padding: 0.75rem 1rem;
      width: 100%;
      text-align: left;
      border-radius: 0.75rem;
    }

    #nav-menu a:hover, #nav-menu button:hover {
      background: #0000ff;
    }

    .group-hover\:block {
      display: none !important;
    }

    .group.active .group-hover\:block {
      display: block !important;
      position: static;
      background: transparent;
      padding: 0.5rem 0 0.5rem 1rem;
      margin-top: 0.5rem;
      box-shadow: none;
      animation: none;
    }

    .group.active svg {
      transform: rotate(180deg);
    }
  }

  /* Add transition delay for dropdown */
  .group:hover .group-hover\:block {
    display: block !important;
    animation: fadeIn 0.2s ease-in-out;
  }

  /* Navbar visibility transition */
  #navbar {
    transform: translate(-50%, -20px);
    transition: transform 0.3s ease, opacity 0.3s ease;
  }

  #navbar.visible {
    transform: translate(-50%, 0);
    opacity: 1 !important;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  const menuToggle = document.getElementById('menu-toggle');
  const navMenu = document.getElementById('nav-menu');
  const moreButton = document.querySelector('.group a');
  const moreGroup = document.querySelector('.group');
  const navbar = document.getElementById('navbar');
  const hero = document.getElementById('hero');

  menuToggle?.addEventListener('click', () => {
    navMenu?.classList.toggle('show');
  });

  // Handle mobile dropdown
  moreButton?.addEventListener('click', (e) => {
    if (window.innerWidth < 640) {
      e.preventDefault();
      moreGroup?.classList.toggle('active');
    }
  });
  
  // Detectar si estamos en la página de inicio para el JavaScript
  const isHomePageJS = window.location.pathname === '/' || window.location.pathname === '/index' || window.location.pathname === '/index.html';

  // Close menu when clicking outside
  document.addEventListener('click', (event) => {
    const target = event.target as HTMLElement;
    if (!target.closest('#menu-toggle') && !target.closest('#nav-menu')) {
      navMenu?.classList.remove('show');
      moreGroup?.classList.remove('active');
    }
  });

  // Show/hide navbar based on scroll position
  window.addEventListener('scroll', () => {
    if (!hero) return;
    
    const heroHeight = hero.offsetHeight;
    const scrollPosition = window.scrollY;
    
    if (scrollPosition > heroHeight - 100) {
      navbar?.classList.add('visible');
      navbar?.classList.remove('opacity-0', 'pointer-events-none');
    } else {
      navbar?.classList.remove('visible');
      navbar?.classList.add('opacity-0', 'pointer-events-none');
    }
  });
</script>